---
title: "Prova Métodos não Paramétricos"
author: "Márcio Alves"
date: '2022-12-20'
output:
  pdf_document: default
  html_document:
    df_print: paged
---

## **Introdução**

O objetivo deste documento é desenvolver algoritmos com a linguagem R para a solução da prova da disciplina Métodos não Paramétricos. 

## **Questão 1**

Nesta questão vamos trabalhar com o teste $\chi^2_{k-1}$ para avaliar se as frequências esperadas são iguais às observadas. Vamos construir as hipóteses do teste.

$$
H_0: O \ modelo \ genético \ proposto \ é \ adequado \ para \ essa \ população.
$$
$$
H_1: O \ modelo \ genético \ proposto \ não \ é \ adequado \ para \ essa \ população.
$$
Vamos testar com $\alpha = 5%$ com $k=3-1$ graus de liberdade. A estatística de teste é constrída da seguinte forma:

$$
q = \frac{\sum_{i = 1}^{3} (F_{oi} - F_{ei})}{F_{ei}}
$$

Vamos construir o teste no código abaixo.

```{r questao1}
F.obs  = c(26,45,29)
v.prob = c(1/4,1/2,1/4)
chisq.test(F.obs, p = v.prob)

qchisq(.05, df=1, lower.tail = FALSE)
```
**Conclusão:** Como a estatística de teste foi $q=1,18$ e a estatística da tabela foi de $Q=3,84$, então não se rejeita $H_0$. Portanto, ao nível de significância $\alpha=0,05$ o modelo genético proposto é adequado para essa população.


## **Questão 2**

Nesta questão vamos testar normalidade utilizando dois testes: Lilliefors e Shapiro-Wilk.

a) Teste Lilliefors. A estatística do teste é calculada calculando a maior frequência observada da diferença em módulo entre a $F(x)$ e $G(x)$ ou $G(x)^0$. Vamos calcular a média e variância dos dados para construir as hipóteses


```{r questao2}
dados <- sort(c(177, 186, 158, 169, 173, 172, 171, 176, 170, 180))
dados

media <- mean(dados)
media # média

variancia <- var(dados)
variancia # variância

dp <- sd(dados)
dp # desvio padrão
```

Agora vamos montar as hipóteses do teste de Lilliefors:

$$
H_0: Os \ dados \ seguem \ uma \ distribuição \ normal \ com \ \bar{X} = 173,2 \ e \ s=7,44.
$$

$$
H_1: Os \ dados \ não \ seguem \ uma \ distribuição \ normal.
$$

Calculando a estatística de teste.

```{r questao2a}
dados <- sort(c(177, 186, 158, 169, 173, 172, 171, 176, 170, 180))
dados

media <- mean(dados)
media # média

variancia <- var(dados)
variancia # variância

dp <- sd(dados)
dp # desvio padrão

z = (dados - mean(dados))/sd(dados)

z

Fx = round(pnorm(z, mean = 0, sd = 1, lower.tail = TRUE), 4)
Fx
  

Gx = seq(0.1,1,0.1)
Gx  
 

Gx_ = seq(0,0.9,0.1)
Gx_


abs(Fx-Gx)

abs(Fx-Gx_)

max(abs(Fx-Gx),abs(Fx-Gx_))
```

**Conclusão:** Na tabela, com $\alpha = 5%$, o valor de $d_i = 0,258$. Como o máximo foi de 0,1861 não se rejeita $H_0$. Neste caso, ao nível de 5%, os dados seguem uma distribuição normal com $\bar{X} = 173,2$ e $s = 7,44$.

b) Teste de Shapiro-Wilk. Neste caso, como o $\alpha$ já está fixado, a estatística do teste é calculada da seguinte forma:

$$
T_{s-w}= \frac{b^2}{(n-1)s^2}
$$
Em que

$$
b = \sum_{i=1}^{k}a_{i,n}[x_{(n-i+1)}-x_{(i)}]
$$

E

$$
s^2 = \sum_{i=1}^{n}\frac{(x_i-\bar{x})}{n-1}
$$

Em que $k=n/2$, $x_{(i)}$ é a observação na i-ésima posição com os dados ordenados. Montando as hipóteses:

$$
H_0: Os \ dados \ seguem \ uma \ distribuição \ normal \ com \ \bar{X} = 173,2 \ e \ s=7,44.
$$

$$
H_1: Os \ dados \ não \ seguem \ uma \ distribuição \ normal.
$$

Vamos calcular as estatísticas de teste:
```{r questao2b}
dados <- sort(c(177, 186, 158, 169, 173, 172, 171, 176, 170, 180))
dados

media <- mean(dados)
media # média

variancia <- var(dados)
variancia # variância

dp <- sd(dados)
dp # desvio padrão

n = length(dados)
n

(n-1)*variancia

y2 = dados[1:5]
y2
length(y2)

y1 = sort(dados[6:10], decreasing = TRUE)
y1
length(y1)


y1-y2

a.i.n = c(0.3751,0.2574,0.2260,0.2032,0.1847,0.1691,0.1554,0.1430,0.1317,0.1212,0.1113,0.1020,0.0932,0.0846,0.0764,0.0685, 0.0608,0.0532,0.0459,0.0386,0.0314,0.0244,0.0174,0.0104,0.0035)
a.i.n

a.i.n*(y1-y2)

b = sum(a.i.n*(y1-y2))
b

T.S.W = b^2 /((n-1)*variancia)
T.S.W
```
**Conclusão:** Na tabela o valor crítico foi de 0,842, que é menor que 2,362151 e não se rejeita $H_0$. Portanto, ao nível de $\alpha=0,05$ os dados seguem uma distribuição normal pelo teste de Shapiro-Wilk.


## **Questão 3**

Neste caso vamos trabalhar com o teste de McNemar. Como $b+c=4+17>20$ então podemos trabalhar com a tabela de McNemar. A estatística de teste é calculada da seguinte forma:

$$
\chi^2= \frac{(|b-c|-1)^2}{b+c}
$$

Vamos construir as hipóteses abaixo.

$$
H_0: O \ tratamento \ não \ foi \ eficaz.
$$

$$
H_1: O \ tratamento \ foi \ eficaz.
$$
Vamos calcular as estatísticas do teste abaixo.

```{r questao3}
library(stats)

questao3 <-matrix(c(45,4,17,34),2,2, byrow = T,
              dimnames = list("Depois" = c("Sem Cefaleia","Com Cefaleia"),
                              "Antes" = c("Sem Cefaleia","Com Cefaleia")
              ))
questao3

# Calculando na mão:

qui_calc <- abs((questao3[1,2]-questao3[2,1]) - 1)/questao3[1,2] + questao3[2,1]
qui_calc

# Pacote do R
mcnemar.test(questao3)
mcnemar.test(questao3, correct=FALSE)
```

**Conclusão:** O $\chi^2_{crítico}$ foi de 11,35, menor que o $\chi^2_{calculado}$ de 20,5, rejeitando $H_0$. Portanto, com $\alpha=0,01$ concluí-se que o tratamento contra a cefaleia foi eficaz. 


**Questão 4**

Vamos construir as hipóteses do teste. Como o teste é para verificar se houve melhora na aprendizagem, será conduzido um teste unilateral à direita com $\alpha = 0,05$ 

$$
H_0: Não \ houve \ melhora \ na \ aprendizagem.
$$

$$
H_1: Houve \ melhora \ na \ aprendizagem.
$$

Vamos calcular as estatisticas de teste.

```{r questao4}
paciente <- c(1:12)
nmc_antes <- c(9, 16, 12, 28, 5, 33, 17, 13, 18, 12, 26, 14)
nmc_depois <- c(14, 22, 18, 23, 11, 40, 15, 18, 22, 31, 19, 8)
diferencas <- nmc_antes - nmc_depois
diferencas

postos <- c(5,6,6,5,6,7,1,5,2,8,7,6)
length(postos)

postos_negativos <- (5+6+6+7+5+2+8+6)
postos_negativos

postos_positivos <- (6+5+1+7)
postos_positivos

Tc <- min(postos_negativos, postos_positivos)
Tc
```

Como o $T_c=19$ > $T_{\alpha;n}$, então não rejeitamos $H_0$ conforme as notas de aula. Portanto, não houve diferença na administração da droga em relação à capacidade de aprendizado.